autoload -U colors && colors

function notify() {
  local NOTIFIER="${1}"
  local NOTIFICATION_MESSAGE="${2}"
  print -P "\n%B%F{black}%K{red}${NOTIFIER}: ${NOTIFICATION_MESSAGE}%k%f%b"
}

function print_installation_instruction() {
  cat <<EOF
${1}
EOF
}

# TMUX PLUGINS
TMUX_PLUGINS_INSTRUCTIONS='
  1. Make sure to install tmux plugins by pressing `Prefix` + `I`.
  2. Then reload tmux by pressing `Prefix` + `r`.
'


# exclude '/tpm' as plugin count
TMUX_NUMBER_OF_PLUGINS_INSTALLED="$(ls $HOME/.tmux/plugins | grep -v tpm | wc -l)"
TMUX_NUMBER_OF_DEFAULT_PLUGINS_INSTALLATION_FOLDER=0
if pgrep tmux &>/dev/null && [[ ! ${TMUX_NUMBER_OF_PLUGINS_INSTALLED} -gt ${TMUX_NUMBER_OF_DEFAULT_PLUGINS_INSTALLATION_FOLDER} ]]; then
  notify "Tmux" "plugins are not installed or missing."
  print_installation_instruction "${TMUX_PLUGINS_INSTRUCTIONS}"
fi

i3_INSTRUCTIONS='
1. Run the following:
    # Verify if wmctrl is installed.
    command -v wmctrl

    # If not, run
    brew install wmctrl || sudo apt install wmctrl

    # Install i3
    sudo apt install i3 or see oficial apt repos https://i3wm.org/docs/repositories.html
'

function check_system_apps() {
  local LINUX_APPS=("spotify" "flameshot" "brave-browser" "firefox-devedition" "i3" "wezterm")

  for app in "${LINUX_APPS[@]}"; do
    if ! command -v "${app}" &>/dev/null; then
      notify "${app}" "This app is NOT installed. See guide below:"
      case ${app} in
        spotify | flameshot | brave-browser | firefox-devedition | wezterm)
          echo "Instructions to install ${app} can be found: https://www.google.com/search?q=${app}+linux"
        ;;
        i3)
          print_installation_instruction "${i3_INSTRUCTIONS}"
        ;;
      *) 
          notify "zsh-notify:" "no instructions were provided for this ${app} "
        ;;
      esac
    fi
  done
}

OS="$(uname)"

[[ "${OS}" == "Linux" ]] && check_system_apps
